
# 메모리
- 현재 실행되고 있는 프로세스들의 명령어와 데이터가 존재
- 여러 프로세스들이 메모리에 동시에 올라가있을 수 있다.

## 메모리 할당

** 연속 할당 **
- 프로세스들은 메모리에 연속적으로 할당
  - 중간에 프로세스가 종료되면 중간중간 빈 공간이 발생
  - 최적 적합, 최초 적합, 최악 적함
  - 외부 단편화 발생

** 불연속 할당 ** 
- 프로세스와 메모리를 일정 크기로 나누어서 매핑해서 할당
- 페이징
  - 프로세스를 프레임이라는 단위로, 메모리를 페이지라는 단위로 나누고 페이지 테이블에 프레임과 페이지를 매핑한 정보를 가지고 있음
  - CPU는 논리 주소 -> 페이지 테이블 -> 물리 주소 형식으로 주소값을 변환하여 메모리에 접근
     - 이 주소 변환 방식을 MMU (Memory Management Unit) 담당 (TLB는 이 안에 있음)
     - 페이지 테이블도 메모리에 적재되어 있기 때문에 메모리에 접근할 때마다 두 번씩 접근
     - TLB (Translation Lookaside Buffer) 캐시를 통해서 페이지 테이블을 캐시하여 메모리 접근 속도를 높일 수 있음
- 세그멘트
  - 프로세스를 논리 단위 (스택 영역, 힙 영역, 데이터 영역)으로 나누어서 별도로 메모리에 적재
  - 외부 단편화 발생

## 가상 메모리
- 프로세스의 전체 데이터를 메모리가 다 로드하면 메모리보다 큰 프로세스를 적재할 수 없음
- 프로세스가 현재 필요로 하는 페이지 (요구 페이지)만 메모리에 존재하고 나머지는 하드 디스크의 스왑 (swap) 영역에 저장하는 방식
- but 요구 페이징만 적재하더라도 프로세스를 많이 실행하다보면 페이지가 부족해 기존 페이지를 스왑 영역으로 옮기고 해당 페이지를 사용하는 '페이지 교체'가 필요함.

### 페이지 교체 알고리즘
페이지 참조열 (page sequence)
- 교체된 페이지들을 시간 순서대로 나열한 문자열
- 중복된 페이지는 제외한다. ex. 2 2 3 4 4 5 5 5 면 2 3 4 5 로 취금
- 그 이유는 연속으로 참조하는 경우는 페이지 교체에 영향을 주지 않기 때문

FIFO (First In First Out)
- 먼저 적재된 페이지 순서대로 먼저 교체되는 알고리즘
- 가장 단순한 알고리즘이지만 계속 사용된 데이터가 계속 교체될 수도 있음

Second Chance 
- FIFO에서 한 번 더 기회를 주는 알고리즘
- 참조 비트를 통해서 교체될 페이지지만 참조 비트가 1인 경우 (적재된 후 참조된 적이 있음) 한 번 더 기회를 주는 것
  - 참조 비트가 0으로 바꾸고 최근 적재된 페이지로 간주 (교체 큐의 맨 마지막으로 이동)
 
OPT (Optimal Page Replacement Algorithm)
- 이후에 가장 적게 참조될 페이지부터 교체하는 알고리즘
- 가장 최적화된 알고리즘이지만 사실상 미래를 알 수 없기에 다른 교체 알고리즘의 효율성을 측정하지 위한 기준으로 사용

LRU (Least Recently Used)
- 가장 최근에 제일 적게 참조된 페이지부터 교체하는 알고리즘
- 페이지 교체 알고리즘 중에서는 제일 효율적임
LFU (Least Frequently Used)
- 가장 적게 참조된 페이지부터 교체하는 알고리즘


### 스래싱 (thrashing)
- 원하는 데이터가 존재하는 페이지가 메모리에 적재되어 있지 않은 경우 페이지 폴트 (fault)가 발생함
- 그럼 CPU는 하던 일을 멈추고 스왑 영역에서 필요한 페이지 가져와 교체 한 후 다시 작업을 재개한다.
- 근데 페이지 교체가 너무 자주 일어나서 오히려 CPU의 성능을 저하시킬 수 있는데 이걸 스래싱이라고 한다.
- 이는 프로세스마다 필요로 하는 최소 프레임 수가 지켜지지 않았기 때문
- 프레임 할당 방식
  - 정적 할당 -> 프로세스마다 동일하게 분배하는 균등 분할. 프로세스 크기에 비례하게 분배하는 비례 분할이 있음
  - 동적 할당
    - 작업 집합 (working set) 모델 -> 작업 집합(일정 시간 동안 참조된 페이지 집합)에 포함된 페이지 수만큼의 프레임은 유지
    - 페이지 폴트 빈도 (PFF, Page Fault Frequency)
      - 폴트 비율이 높을 경우 프레임을 추가할당하고, 비율이 낮을 경우 회수
